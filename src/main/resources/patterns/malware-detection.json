{
  "version": "1.0.0",
  "name": "Malware Detection Patterns",
  "description": "Enhanced patterns for malware and advanced threat detection",
  "categories": {
    "network": {
      "severity": "warning",
      "description": "ネットワーク通信の検出",
      "patterns": [
        {
          "name": "UnityWebRequest",
          "description": "ネットワーク通信が検出されました",
          "regex": "UnityWebRequest\\s*\\.\\s*(Get|Post|Put|Delete|Head|Patch)",
          "flags": "gi",
          "severity": "warning"
        },
        {
          "name": "HttpClient",
          "description": "HTTP通信ライブラリの使用が検出されました",
          "regex": "(HttpClient|WebClient|HttpWebRequest)\\s*[\\(\\.]",
          "flags": "gi",
          "severity": "warning"
        },
        {
          "name": "Socket",
          "description": "ソケット通信が検出されました",
          "regex": "(Socket|TcpClient|UdpClient|NetworkStream)\\s*\\(",
          "flags": "gi",
          "severity": "critical"
        },
        {
          "name": "SuspiciousURL",
          "description": "疑わしいURL文字列が検出されました",
          "regex": "(https?:\\/\\/)([^\\s\"']*\\.(tk|ml|ga|cf|bit\\.ly|tinyurl|pastebin|discord|telegram))",
          "flags": "gi",
          "severity": "critical"
        },
        {
          "name": "DataExfiltration",
          "description": "データ流出の可能性があるエンドポイント",
          "regex": "(upload|exfil|steal|leak|dump|extract).*data",
          "flags": "gi",
          "severity": "critical"
        }
      ]
    },
    "process": {
      "severity": "critical",
      "description": "プロセス実行の検出",
      "patterns": [
        {
          "name": "Process.Start",
          "description": "外部プロセス実行が検出されました",
          "regex": "Process\\s*\\.\\s*Start",
          "flags": "gi",
          "severity": "critical"
        },
        {
          "name": "PowerShellExecution",
          "description": "PowerShell実行が検出されました",
          "regex": "(powershell|pwsh)\\s*(\\.exe)?",
          "flags": "gi",
          "severity": "critical"
        },
        {
          "name": "SystemCommands",
          "description": "システムコマンド実行が検出されました",
          "regex": "(cmd\\.exe|bash|sh|/bin/)",
          "flags": "gi",
          "severity": "critical"
        }
      ]
    },
    "obfuscation": {
      "severity": "warning",
      "description": "難読化・暗号化の兆候",
      "patterns": [
        {
          "name": "Base64Encoding",
          "description": "Base64エンコーディングが検出されました",
          "regex": "(Convert\\.(From|To)Base64String|FromBase64|ToBase64)",
          "flags": "gi",
          "severity": "warning"
        },
        {
          "name": "LongHardcodedString",
          "description": "長いハードコード文字列が検出されました",
          "regex": "\"[A-Za-z0-9+/=]{50,}\"",
          "flags": "g",
          "severity": "warning"
        },
        {
          "name": "Encryption",
          "description": "暗号化処理が検出されました",
          "regex": "(AES|DES|RSA|Encrypt|Decrypt|Cipher)",
          "flags": "gi",
          "severity": "info"
        }
      ]
    },
    "persistence": {
      "severity": "critical",
      "description": "永続化メカニズムの検出",
      "patterns": [
        {
          "name": "RegistryPersistence",
          "description": "レジストリによる永続化が検出されました",
          "regex": "Registry.*\\\\(Run|RunOnce|CurrentVersion)",
          "flags": "gi",
          "severity": "critical"
        },
        {
          "name": "ServiceInstallation",
          "description": "サービス登録が検出されました",
          "regex": "(ServiceController|sc\\.exe|CreateService)",
          "flags": "gi",
          "severity": "critical"
        },
        {
          "name": "TaskScheduler",
          "description": "タスクスケジューラ登録が検出されました",
          "regex": "(schtasks|TaskScheduler)",
          "flags": "gi",
          "severity": "critical"
        }
      ]
    },
    "evasion": {
      "severity": "warning",
      "description": "回避技術の検出",
      "patterns": [
        {
          "name": "AntiDebug",
          "description": "デバッグ検出回避が検出されました",
          "regex": "(IsDebuggerPresent|CheckRemoteDebuggerPresent|Debugger\\.IsAttached)",
          "flags": "gi",
          "severity": "warning"
        },
        {
          "name": "VirtualMachineDetection",
          "description": "仮想マシン検出が検出されました",
          "regex": "(VMware|VirtualBox|VBox|Hyper-V|Xen)",
          "flags": "gi",
          "severity": "warning"
        },
        {
          "name": "SandboxEvasion",
          "description": "サンドボックス回避が検出されました",
          "regex": "(Sleep|Thread\\.Sleep|Delay)\\s*\\(\\s*[0-9]{4,}",
          "flags": "gi",
          "severity": "warning"
        }
      ]
    }
  },
  "presets": {
    "malware_hunter": {
      "name": "マルウェア検出モード",
      "description": "マルウェア特有のパターンを重点的に検出",
      "enabledCategories": ["network", "process", "obfuscation", "persistence", "evasion", "dll"]
    },
    "apt_detection": {
      "name": "APT検出モード", 
      "description": "高度持続的脅威の検出に特化",
      "enabledCategories": ["network", "process", "persistence", "evasion"],
      "excludePatterns": ["Encryption"]
    }
  }
}